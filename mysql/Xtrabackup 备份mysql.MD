<p>
	<span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">http://www.jb51.net/article/36183.htm<br />
</span>
</p>
<p>
	<span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">Xtrabackup有两个主要的工具：xtrabackup、innobackupex&nbsp;</span>
</p>
<br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">（1）xtrabackup只能备份InnoDB和XtraDB两种数据表，而不能备份MyISAM数据表&nbsp;</span><br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">（2）innobackupex-1.5.1则封装了xtrabackup，是一个脚本封装，所以能同时备份处理innodb和myisam，但在处理myisam时需要加一个读锁&nbsp;</span><br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">（3）使用帮助：</span><a href="http://www.percona.com/docs/wiki/percona-xtrabackup:start" target="_blank" style="color:#006699;text-decoration-line:none;font-size:14px;font-family:tahoma, arial, 宋体;white-space:normal;background-color:#FFFFFF;">http://www.percona.com/docs/wiki/percona-xtrabackup:start</a><span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">&nbsp;</span><br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">环境：CentOS 5.4,xtrabackup-1.6.tar.gz&nbsp;</span><br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">1、首先从</span><a href="http://www.percona.com/" target="_blank" style="color:#006699;text-decoration-line:none;font-size:14px;font-family:tahoma, arial, 宋体;white-space:normal;background-color:#FFFFFF;">http://www.percona.com/</a><span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">下载&nbsp;</span><br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<a href="http://www.jb51.net/article/wget%20http://www.percona.com/downloads/XtraBackup/XtraBackup-1.6/Linux/binary/i686/xtrabackup-1.6.tar.gz" target="_blank" style="color:#006699;text-decoration-line:none;font-size:14px;font-family:tahoma, arial, 宋体;white-space:normal;background-color:#FFFFFF;">wget http://www.percona.com/downloads/XtraBackup/XtraBackup-1.6/Linux/binary/i686/xtrabackup-1.6.tar.gz</a><span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">&nbsp;</span><br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<strong style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">2、检查服务器是否安装了Mysql版本，如果没有就要安装好mysql&nbsp;<br />
</strong><br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">my.cnf中必须有datadir=/var/lib/mysql&nbsp;</span><br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<strong style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">3、开始安装xtrabackup</strong><span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">&nbsp;</span><br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">1)解压&nbsp;</span><br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">cd /qeedoodb/setup&nbsp;</span><br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">tar zxvf xtrabackup-1.6.tar.gz&nbsp;</span><br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">2)拷贝innobackupex、xtrabackup、xtrabackup_51 工具到/usr/bin&nbsp;</span><br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">cp /qeedoodb/setup/xtrabackup-1.6/bin/innobackupex /usr/bin/innobackupex&nbsp;</span><br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">cp /qeedoodb/setup/xtrabackup-1.6/bin/xtrabackup /usr/bin/xtrabackup&nbsp;</span><br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">cp /qeedoodb/setup/xtrabackup-1.6/bin/xtrabackup_51 /usr/bin/xtrabackup_51&nbsp;</span><br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<strong style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">4、备份并打包压缩&nbsp;<br />
</strong><br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">innobackupex --user=root --password=123456 --defaults-file=/etc/my.cnf --database=zztx --stream=tar /data/back_data/ 2&gt;/data/back_data/zztx.log | gzip 1&gt;/data/back_data/zztx.tar.gz&nbsp;</span><br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">说明：&nbsp;</span><br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">--database=zztx 单独对zztx数据库做备份 ，若是不添加此参数那就那就是对全库做备份&nbsp;</span><br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">2&gt;/data/back_data/zztx.log 输出信息写入日志中&nbsp;</span><br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">1&gt;/data/back_data/zztx.tar.gz 打包压缩存储到该文件中&nbsp;</span><br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">此处可以写个脚本做备份(backup.sh)&nbsp;</span><br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">#!/bin/sh&nbsp;</span><br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">echo "开始备份..."`date`&nbsp;</span><br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">log=zztx01_`date +%y%m%d%H%M`.log&nbsp;</span><br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">str=zztx01_`date +%y%m%d%H%M`.tar.gz&nbsp;</span><br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">innobackupex --user=root --password=123456 --defaults-file=/etc/my.cnf --database=zztx --stream=tar /data/back_data/ 2&gt;/data/back_data/$log | gzip 1&gt;/data/back_data/$str&nbsp;</span><br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">echo "备份完毕..."`date`&nbsp;</span><br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<strong style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">5、恢复数据</strong><span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">&nbsp;</span><br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">1) 先停止数据库：service mysqld stop&nbsp;</span><br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">2) 解压 tar -izxvf zztx.tar.gz -C /data/back_data/db/ (没有db ,需要mkdir /data/back_data/db/)&nbsp;</span><br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">3) 恢复 innobackupex --user=root --password --defaults-file=/etc/my.cnf --apply-log /data/back_data/db/ (--apply-log选项的命令是准备在一个备份上启动mysql服务)&nbsp;</span><br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">innobackupex --user=root --password --defaults-file=/etc/my.cnf --copy-back /data/back_data/db/ (--copy-back 选项的命令从备份目录拷贝数据,索引,日志到my.cnf文 件里规定的初始位置。)&nbsp;</span><br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">4) 赋权 chown -R mysql.mysql /var/lib/mysql/*&nbsp;</span><br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">5) 重启数据库 service mysqld restart&nbsp;</span><br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">6) 删除垃圾 cd /var/lib/mysql/ &amp;&amp; rm xtrabackup*&nbsp;</span><br style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;" />
<span style="font-family:tahoma, arial, 宋体;font-size:14px;white-space:normal;background-color:#FFFFFF;">进入数据库查看，一切OK~</span>